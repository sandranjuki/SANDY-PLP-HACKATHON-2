<!DOCTYPE html>
<html>
<head>
    <title>MediLink AI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container py-5">
    <h1 class="text-center mb-4">🩺 MedTrackr - Patient Management</h1>

    <!-- Add Patient Form -->
    <div class="card p-3 shadow mb-4">
        <form method="POST" action="/add" class="row g-3">
            <div class="col-md-4">
                <input type="text" name="name" placeholder="Patient Name" class="form-control" required>
            </div>
            <div class="col-md-2">
                <input type="number" name="age" placeholder="Age" class="form-control" required>
            </div>
            <div class="col-md-4">
                <input type="text" name="condition" placeholder="Condition / Notes" class="form-control" required>
            </div>
            <div class="col-md-2 d-grid">
                <button type="submit" class="btn btn-primary">Add</button>
            </div>
        </form>
    </div>

    <!-- Patient Timeline -->
    <h3 class="mb-3">📋 Patient Records</h3>
    {% if patients %}
        <ul class="list-group">
            {% for p in patients %}
                <li class="list-group-item">
                    <strong>{{ p[1] }}</strong> (Age: {{ p[2] }})  
                    <br>📝 {{ p[3] }}  
                    <span class="text-muted float-end">{{ p[4] }}</span>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p class="text-muted">No patient history yet. Add one above!</p>
    {% endif %}

    <!-- AI Chatbot -->
    <div class="card p-3 shadow mt-5">
        <h4>💬 Ask MedTrackr AI</h4>
        <div id="chat-box" class="border p-3 mb-3 bg-white" style="height:200px; overflow-y:auto;">
            <p class="text-muted">Chatbot ready. Ask a health question!</p>
        </div>
        <div class="input-group">
            <input id="user-input" type="text" class="form-control" placeholder="Type your question...">
            <button onclick="sendMessage()" class="btn btn-success">Send</button>
        </div>
    </div>
</div>

<script>
async function sendMessage() {
    let input = document.getElementById("user-input");
    let chatBox = document.getElementById("chat-box");

    let userMessage = input.value;
    if (!userMessage) return;

    chatBox.innerHTML += `<p><strong>You:</strong> ${userMessage}</p>`;
    input.value = "";

    let response = await fetch("/chat", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({message: userMessage})
    });

    let data = await response.json();
    chatBox.innerHTML += `<p><strong> MedTrackrAI:</strong> ${data.reply}</p>`;
    chatBox.scrollTop = chatBox.scrollHeight;
}
</script>

</body>
</html>
